<!DOCTYPE html>
<html>
<head>
  <title>Transform</title>
	<script type="text/javascript" src='https://www.google.com/jsapi?autoload={"modules":[{"name":"visualization","version":"1","packages":["corechart","table"]}]}'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
  <script src="../holy-diver.js"></script>
  <script>

		google.setOnLoadCallback(function(){
			
			$.getJSON("http://localhost:8000/sample-data/git-traffic-data.json", function(response) {
				// console.log(data);

				var data = new flatten(response.counts, {
					cols: {
						fixed: ['date', 'visits']
					},
					rows: {
						index: 'bucket',
						cells: 'total',
						transform: {
							0: function(value, index){
								var date = new Date();
								var minus = new Date(date.setDate(date.getDate()-(16-index)));
								var formatted = (minus.getUTCMonth()+1) + '/' + (minus.getUTCDate());
								console.log();
								return String(formatted);
							}
						}
					},
					order: {
						rows: 'date:asc'
					}
				});
				
				$('#total-views').html('Total: ' + response.summary.total);
				$('#total-unique').html('Unique: ' + response.summary.unique);
				
				data.table.splice(1,2);
				
				console.log(data.table);
				
				
				var table = google.visualization.arrayToDataTable(data.table);
				var chart = new google.visualization.SteppedAreaChart(document.getElementById('chart'));
				chart.draw(table, {
					height: 300,
					width: 1000
				});
				
			});
			
		});
  
	</script>
</head>
<body>
  <div id="chart"></div>
	<div id="total-views" style="float: left; text-align: center; width: 50%"></div>
	<div id="total-unique" style="float: left; text-align: center; width: 20%"></div>
</body>
</html>