function Dataform(a,b){this.build(a,b)}function parse(){var a=[],b=function(){var c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=d.pop();return 0===d.length&&(c instanceof Array?d=c:"object"==typeof c&&d.push(c)),each(d,function(f){return""==e&&"number"==typeof f?a.push(f):f[e]||0===f[e]||void 0!==f[e]?a.push(null===f[e]?"":f[e]):c[f]?c[f]instanceof Array?void each(c[f],function(a,g){var h=[c[f]].concat(c[f][g]).concat(d.slice(1)).concat(e);return b.apply(this,h)}):c[f][e]?a.push(c[f][e]):b.apply(this,[c[f]].concat(d.splice(1)).concat(e)):b.apply(this,[f].concat(d.splice(1)).concat(e))}),a.length>0?a:void 0};return b.apply(this,arguments)}function is(a,b){return a=typeof a,b?a==b:"undefined"!=a}function each(a,b,c){var d;if(!a)return 0;if(c=c?c:a,is(a.length)){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}Dataform.prototype.build=function(a,b){var c,d=this;return c=""==b.root?[[a]]:parse.apply(d,[a].concat(b.root.split(" -> "))),d.root=c[0],d.map=b,d.table=[],d.series=[],d.raw=a,d.cols=function(){var a,b,c={fixed:[]};return b=d.map.each.value.split(" -> "),a=d.map.each.index?d.map.each.index.split(" -> "):d.map.each.value.split(" -> "),c.fixed.push(a[a.length-1]),d.map.each.label?c.cells=d.map.each.label.split(" -> "):c.fixed.push(b[b.length-1]),c}(),d.rows={index:d.map.each.index?d.map.each.index.split(" -> "):["result"],cells:d.map.each.value?d.map.each.value.split(" -> "):[]},d.order=function(){var a={};return d.map.sort&&(a.rows=d.map.sort.index||"asc",a.cols=d.map.sort.label||"desc"),a}(),d.order.rows.length>0&&d.root instanceof Array&&d.root.sort(function(a,b){var c=parse.apply(d,[a].concat(d.rows.index)),e=parse.apply(d,[b].concat(d.rows.index));return"asc"==d.order.rows?c>e?1:e>c?-1:0:c>e?-1:e>c?1:0}),function(){d.cols.fixed&&""==d.cols.fixed[d.cols.fixed.length-1]?(d.cols.label=d.cols.fixed[d.cols.fixed.length-1],fixed=d.cols.fixed,fixed.splice(fixed.length-1,1)):(d.cols.label=fixed=d.cols.fixed[0],fixed=d.cols.fixed);var a=d.cols.cells?parse.apply(d,[d.root[0]].concat(d.cols.cells)):[],b=fixed.concat(a);b.length>1&&b.splice(0,1),each(b,function(a){d.series.push({key:a,values:[]})})}(),d.root instanceof Array||"object"==typeof d.root?each(d.root,function(a){var b=parse.apply(d,[a].concat(d.rows.index)),c=parse.apply(d,[a].concat(d.rows.cells));b.length>1?each(b,function(a,b){var e={};e[d.cols.label]=a,e.value=c[b],d.series[0].values.push(e)}):each(c,function(a,c){var e={};e[d.cols.label]=b[0],e.value=a,d.series[c].values.push(e)})}):!function(){var a={};a[d.cols.label]="result",a.value=d.root,d.series[0].values.push(a)}(),d.order.cols.length>0&&(d.series=d.series.sort(function(a,b){var c=0,e=0;return each(a.values,function(a){c+=a.value}),each(b.values,function(a){e+=a.value}),"asc"==d.order.cols?c-e:e-c})),d.table=[],d.table.push([d.cols.label]),each(d.series[0].values,function(a){d.table.push([a[d.cols.label]])}),each(d.series,function(a){d.table[0].push(a.key),each(a.values,function(a,b){d.table[b+1].push(a.value)})}),this},Dataform.prototype.average=function(){return[5]},Dataform.prototype.count=function(){return[10]},Dataform.prototype.maximum=function(){return[9]},Dataform.prototype.median=function(){return[4.3]},Dataform.prototype.minimum=function(){return[0]},Dataform.prototype.mode=function(){return[3]},Dataform.prototype.sum=function(){return[23]};